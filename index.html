<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Development Team Setup ROI Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/3.0.1/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth; /* Smooth scroll for better UX */
        }
        /* Hide number input spinners for a cleaner look */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield; /* Firefox */
        }
        /* Styles for the collapsible explanation section */
        .explanation-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out; /* Smooth transition */
        }
        .explanation-content.show {
            max-height: 2800px; /* Adjust max-height as needed for content */
            transition: max-height 0.5s ease-in; /* Smooth transition */
        }
        /* Custom focus styles for accessibility */
        input:focus,
        select:focus, button:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* Tailwind blue-500 focus ring */
        }
        /* Style disabled inputs for visual clarity */
        .inputs-disabled input, .inputs-disabled select {
            background-color: #f3f4f6; /* gray-100 */
            cursor: not-allowed;
            opacity: 0.6; /* Make them visually distinct when disabled */
        }
        /* Ensure PDF content area has a white background for capture */
        #pdf-content-area {
            background-color: white;
        }
        /* Style for asterisk footnote */
        .footnote {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* gray-500 */
            margin-top: 0.5rem; /* mt-2 */
        }
        /* Ensure consistent height for input sections in the 3-column layout */
        .input-section-column {
            display: flex;
            flex-direction: column;
            height: 100%; /* Make sections take full height of grid cell */
        }
        .input-section-column .input-content {
            flex-grow: 1; /* Allow form content to grow */
            display: flex;
            flex-direction: column;
        }
        .input-section-column .input-content .footnote {
            margin-top: auto; /* Push footnote to bottom */
        }
        /* Result sections styling */
        .result-section-card {
            display: flex;
            flex-direction: column;
        }
        .result-section-card .result-content {
            flex-grow: 1; /* Allow result content to grow */
        }
        /* Custom separator style */
        .separator {
            border-top: 1px solid #e5e7eb; /* gray-200 */
            margin-top: 1rem; /* mt-4 */
            margin-bottom: 1rem; /* mb-4 */
        }
        /* Error message box style */
        #error-message-box {
            transition: opacity 0.5s ease-in-out;
        }
        /* Frame for grouping inputs */
        .input-frame {
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            margin-top: 1rem; /* mt-4 */
            background-color: #f9fafb; /* gray-50 */
        }
        .input-frame h4 {
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: #374151; /* gray-700 */
            margin-bottom: 0.75rem; /* mb-3 */
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }

        /* PDF Capture Enhancements & General Input Styling Improvements */
        #pdf-content-area form input[type="number"],
        #pdf-content-area form input[type="text"], /* For any future text inputs */
        #pdf-content-area form select {
            padding-top: 0.65rem;    /* Increased from default p-2 (0.5rem) */
            padding-bottom: 0.65rem;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            box-sizing: border-box; /* Crucial for consistent sizing */
            vertical-align: middle; /* Helps with text alignment within the field */
            border-radius: 0.375rem; /* Ensure consistent rounded corners (rounded-md) */
            border: 1px solid #D1D5DB; /* Ensure consistent border (gray-300) */
        }

        /* Adjust padding for inputs with leading currency symbol more precisely */
        #pdf-content-area form .relative input[type="number"].pl-7 {
            padding-left: 2.1rem; /* Original Tailwind pl-7 is 1.75rem. This provides more space. */
        }

        /* Custom styling for select elements for better PDF rendering and consistency */
        #pdf-content-area form select {
            appearance: none; /* Remove default browser appearance */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236B7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E"); /* Tailwind gray-500 for arrow */
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.25em 1.25em; /* Slightly smaller arrow */
            padding-right: 2.5rem; /* Make space for the custom arrow */
            min-height: 2.80rem; /* Ensures a decent height, slightly more than h-10 (2.5rem) */
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="error-message-box" class="hidden fixed top-5 right-5 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-md z-50" role="alert">
        <strong class="font-bold">Error!</strong>
        <span class="block sm:inline" id="error-message-text">Something went wrong.</span>
        <button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.classList.add('hidden')">
            <svg class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Close</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/></svg>
        </button>
    </div>

    <div id="pdf-content-area" class="p-4 sm:p-6 rounded-lg shadow-lg max-w-7xl mx-auto my-8 bg-white">
        <div class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-900 mb-3">Sales Development Team Setup ROI Calculator</h1>
            <p class="text-gray-600 text-base sm:text-lg max-w-3xl mx-auto">Estimate the financial impact of your Sales Development Representative (SDR) investment, including optional fractional sales management and HR overheads.</p>
        </div>

        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-blue-900 mb-5 border-b pb-3 text-center">Input Parameters</h2>
            <form id="roi-form" class="grid grid-cols-1 md:grid-cols-3 gap-6 lg:gap-8">

                <section class="bg-white p-5 sm:p-6 rounded-lg shadow input-section-column">
                    <h3 class="text-lg font-medium text-blue-800 mb-3">Core Team Structure</h3>
                    <div class="space-y-4 input-content">
                        <div>
                            <label for="numberOfSDRs" class="block text-sm font-medium text-gray-700 mb-1">Number of SDRs you plan to onboard</label>
                            <input id="numberOfSDRs" type="number" name="numberOfSDRs" value="2" min="0" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                            <p class="text-xs text-gray-500 mt-1">Total Sales Development Representatives.</p>
                        </div>
                        <div>
                            <label for="leadsPerSDRMonth" class="block text-sm font-medium text-gray-700 mb-1">Target Qualified Leads / SDR / Month</label>
                            <input id="leadsPerSDRMonth" type="number" name="leadsPerSDRMonth" value="12" min="0" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                            <p class="text-xs text-gray-500 mt-1">Your target for a fully ramped SDR.</p>
                        </div>

                        <div class="input-frame">
                            <h4>SDR Compensation Package (per SDR)</h4>
                            <div>
                                <label for="sdrMonthlySalary" class="block text-sm font-medium text-gray-700 mb-1">Monthly SDR Salary Package (AUD, incl. Superannuation)<span class="text-red-500">*</span></label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                    <input id="sdrMonthlySalary" type="number" name="sdrMonthlySalary" value="1900" min="0" step="100" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Enter the total monthly salary package, including superannuation.</p>
                            </div>
                            <div class="mt-3">
                                <label for="sdrVariableCommission" class="block text-sm font-medium text-gray-700 mb-1">Monthly Variable Commission per SDR (AUD)</label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                    <input id="sdrVariableCommission" type="number" name="sdrVariableCommission" value="800" min="0" step="50" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Adjust as needed. This is the on-target commission.</p>
                            </div>
                            <div class="mt-3">
                                <p class="text-sm text-gray-600">Total Monthly Compensation per SDR (OTE):</p>
                                <p class="text-md font-semibold text-blue-700" id="output-totalSDRCompensationPerSDR">$--</p>
                            </div>
                        </div>
                        
                        <div>
                            <label for="monthlySaasTools" class="block text-sm font-medium text-gray-700 mb-1">Your Monthly SaaS & Tools Cost / SDR (AUD)</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="monthlySaasTools" type="number" name="monthlySaasTools" value="350" min="0" step="10" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">e.g., CRM, Sales Engagement, Data, Telephony.</p>
                        </div>
                        <div class="footnote pt-4"> <span class="text-red-500">*</span> Note: For certain regions (e.g., Philippines-based SDRs), a mandatory 13th-month salary or similar may apply. This calculator focuses on standard operational costs; consider such specific regional requirements separately.
                        </div>
                    </div>
                </section>

                <section class="bg-white p-5 sm:p-6 rounded-lg shadow input-section-column">
                    <h3 class="text-lg font-medium text-blue-800 mb-3">Sales Performance Metrics</h3>
                    <div class="space-y-4 input-content">
                        <div class="input-frame">
                            <h4>Deal Value & Profitability</h4>
                            <div>
                                <label for="averageDealSize" class="block text-sm font-medium text-gray-700 mb-1">Your Average Deal Size (AUD)</label>
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                    <input id="averageDealSize" type="number" name="averageDealSize" value="30000" min="0" step="100" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                            </div>
                            <div class="mt-3">
                                <label for="averageGrossMargin" class="block text-sm font-medium text-gray-700 mb-1">Your Average Gross Margin (%)</label>
                                <input id="averageGrossMargin" type="number" name="averageGrossMargin" value="60" min="0" max="100" step="1" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                <p class="text-xs text-gray-500 mt-1">(Revenue - COGS) / Revenue. Impacts gross profit per deal.</p>
                            </div>
                        </div>

                        <div>
                            <label for="averageSalesCycle" class="block text-sm font-medium text-gray-700 mb-1">Your Average Sales Cycle (Months)</label>
                            <input id="averageSalesCycle" type="number" name="averageSalesCycle" value="4" min="0" max="36" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                            <p class="text-xs text-gray-500 mt-1">Typical time from qualified lead to closed deal.</p>
                        </div>
                        <div>
                            <label for="leadConversionRate" class="block text-sm font-medium text-gray-700 mb-1">Your Lead to Customer Conversion Rate (%)</label>
                            <input id="leadConversionRate" type="number" name="leadConversionRate" value="20" min="0" max="100" step="1" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                             <p class="text-xs text-gray-500 mt-1">Percentage of qualified leads that become customers.</p>
                        </div>
                        <div>
                            <label for="customerLifetimeValue" class="block text-sm font-medium text-gray-700 mb-1">Your Customer Lifetime Value (LTV) Basis</label>
                            <select id="customerLifetimeValue" name="customerLifetimeValue" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="12">12 Months (No Renewals Calculated)</option>
                                <option value="18">18 Months (50% Year 1 Value as Renewal)</option>
                                <option value="24" selected>24 Months (100% Year 1 Value as Renewal)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Select to factor in potential renewal revenue for LTV ROI.</p>
                        </div>
                        <div>
                            <div class="flex items-center mt-2">
                                <input id="isTeamFullyRamped" type="checkbox" name="isTeamFullyRamped" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                <label for="isTeamFullyRamped" class="ml-2 block text-sm font-medium text-gray-700">Team Starts Fully Ramped</label>
                            </div>
                            <p id="ramp-up-note" class="text-xs text-gray-500 mt-1 pl-6 hidden">If unchecked, assumes 50% productivity for months 1-3, then 100% from month 4.</p>
                        </div>
                    </div>
                </section>

                <section class="bg-white p-5 sm:p-6 rounded-lg shadow input-section-column">
                    <h3 class="text-lg font-medium text-blue-800 mb-3">Additional Operational Costs</h3>
                    <div class="space-y-4 input-content">
                        <div>
                            <div class="flex items-center mb-2">
                                <input id="includeFractionalSalesManagement" type="checkbox" name="includeFractionalSalesManagement" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                <label for="includeFractionalSalesManagement" class="ml-2 block text-sm font-medium text-gray-700">Include Fractional Sales Management</label>
                            </div>
                            <div id="fractional-sales-inputs-container" class="grid grid-cols-1 gap-4 pl-6 border-l-2 border-blue-100 ml-2 pt-2 hidden">
                                <p class="text-xs text-gray-600 mb-2">Covers external expertise for SDR team setup, training, and/or ongoing management.</p>
                                <div>
                                    <label for="fractionalOnboardingCost" class="block text-sm font-medium text-gray-700 mb-1">Monthly Cost for 4-Month Onboarding & Training Support (AUD)</label>
                                    <div class="relative">
                                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                        <input id="fractionalOnboardingCost" type="number" name="fractionalOnboardingCost" value="5675" min="0" step="50" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Monthly cost during the initial 4-month onboarding period.</p>
                                </div>
                                
                                <div class="mt-2">
                                    <div class="flex items-center">
                                        <input id="includeOngoingFractionalSupport" type="checkbox" name="includeOngoingFractionalSupport" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                        <label for="includeOngoingFractionalSupport" class="ml-2 block text-sm font-medium text-gray-700">Include Ongoing Fractional Management Support</label>
                                    </div>
                                </div>
                                <div id="ongoing-fractional-support-container" class="grid grid-cols-1 gap-4 hidden">
                                    <div>
                                        <label for="ongoingFractionalDuration" class="block text-sm font-medium text-gray-700 mb-1">Duration of Ongoing Support (Months)</label>
                                        <select id="ongoingFractionalDuration" name="ongoingFractionalDuration" class="w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                            <option value="2">2 Months</option>
                                            <option value="4">4 Months</option>
                                            <option value="6" selected>6 Months</option>
                                            <option value="8">8 Months</option>
                                            <option value="10">10 Months</option>
                                            <option value="12">12 Months</option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-1">How long ongoing support is provided after the initial 4-month onboarding.</p>
                                    </div>
                                    <div>
                                        <label for="ongoingFractionalMonthlyCost" class="block text-sm font-medium text-gray-700 mb-1">Monthly Cost for Ongoing Support (AUD)</label>
                                        <div class="relative">
                                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                            <input id="ongoingFractionalMonthlyCost" type="number" name="ongoingFractionalMonthlyCost" value="3750" min="0" step="50" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center mb-2">
                                <input id="includeHRPayrollOverheads" type="checkbox" name="includeHRPayrollOverheads" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                <label for="includeHRPayrollOverheads" class="ml-2 block text-sm font-medium text-gray-700">Include HR & Payroll Overheads</label>
                            </div>
                            <div id="hr-payroll-inputs-container" class="grid grid-cols-1 gap-4 pl-6 border-l-2 border-blue-100 ml-2 pt-2 hidden">
                                <div>
                                    <label for="hrPayrollOverheadsPerSDR" class="block text-sm font-medium text-gray-700 mb-1">Your Monthly HR & Payroll Overheads / SDR (AUD)</label>
                                    <div class="relative">
                                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                        <input id="hrPayrollOverheadsPerSDR" type="number" name="hrPayrollOverheadsPerSDR" value="595" min="0" step="10" class="pl-7 w-full p-2 border border-gray-300 rounded shadow-sm focus:ring-blue-500 focus:border-blue-500"/>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">e.g., Payroll processing, HR admin costs per SDR.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </form>
        </div>

        <div class="bg-blue-50 p-5 sm:p-6 rounded-lg shadow">
            <h2 class="text-2xl font-semibold text-blue-900 mb-5 border-b pb-3 text-center">Estimated Results</h2>
            <div class="space-y-6 lg:space-y-8">

                <div class="bg-white p-4 rounded-lg shadow-sm result-section-card">
                    <h3 class="text-lg font-medium text-blue-900 mb-2">Lead Generation & Costs</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-3 result-content">
                        <div>
                            <p class="text-sm text-gray-600">Avg Monthly Qualified Leads</p>
                            <p class="text-lg font-bold" id="output-monthlyLeads">--</p>
                            <p class="text-xs text-gray-500 hidden" id="output-monthlyLeads-note">(Avg. during ramp/full)</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Year 1 Qualified Leads</p>
                            <p class="text-lg font-bold" id="output-annualLeads">--</p>
                            <p class="text-xs text-gray-500 hidden" id="output-annualLeads-note">(Includes ramp-up period)</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Cost Per Lead (CPL)</p>
                            <p class="text-lg font-bold" id="output-costPerLead">$--</p>
                            <p class="text-xs text-gray-500" id="output-cpl-note">(Y1 Inv. / Y1 Leads)</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Cost Per Acquisition (CPA)</p>
                            <p class="text-lg font-bold" id="output-costPerAcquisition">$--</p>
                            <p class="text-xs text-gray-500" id="output-cpa-note">(Y1 Inv. / Y1 New Deals)</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
                    <div class="bg-white p-4 rounded-lg shadow-sm result-section-card">
                        <h3 class="text-lg font-medium text-blue-900 mb-2">Year 1 Performance</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3 result-content">
                            <div>
                                <p class="text-sm text-gray-600">Year 1 Pipeline Generated</p>
                                <p class="text-lg font-bold" id="output-annualPipeline">$--</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">First Revenue Expected</p>
                                <p class="text-lg font-bold">Month <span id="output-firstRevenueMonth">--</span> ($<span id="output-firstRevenueAmount">--</span>)</p>
                                <p class="text-xs text-gray-500">(After <span id="output-salesCycleDisplay">--</span>-month cycle)</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Year 1 New Deals Closed</p>
                                <p class="text-lg font-bold" id="output-year1Deals">--</p>
                                <p class="text-xs text-gray-500">(Based on <span id="output-conversionRateDisplay">--</span>% conversion)</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Year 1 Total Revenue</p>
                                <p class="text-xl font-bold text-green-700" id="output-year1Revenue">$--</p>
                            </div>
                             <div>
                                <p class="text-sm text-gray-600">Year 1 Gross Profit</p>
                                <p class="text-xl font-bold text-green-600" id="output-year1GrossProfit">$--</p>
                                <p class="text-xs text-gray-500">(Based on <span id="output-grossMarginDisplayY1">--</span>% Margin)</p>
                            </div>
                            <div class="sm:col-span-2">
                                <p class="text-sm text-gray-600">Est. Revenue from Y1 Leads Closing in Y2</p>
                                <p class="text-lg font-bold text-orange-600" id="output-unrealizedRevenueY2">$--</p>
                                <p class="text-xs text-gray-500">(Due to sales cycle delay)</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-sm result-section-card">
                        <h3 class="text-lg font-medium text-blue-900 mb-2">Year 2 Performance</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3 result-content">
                            <div>
                                <p class="text-sm text-gray-600">Year 2 New Deals Closed</p>
                                <p class="text-lg font-bold" id="output-year2Deals">--</p>
                                <p class="text-xs text-gray-500">(Incl. deals from Y1 leads)</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Year 2 New Deal Revenue</p>
                                <p class="text-lg font-bold" id="output-year2Revenue">$--</p>
                            </div>
                            <div id="output-renewal-section" class="hidden">
                                <p class="text-sm text-gray-600">Y1 Customer Renewals (in Y2)</p>
                                <p class="text-lg font-bold text-green-700" id="output-year1RenewalRevenue">$--</p>
                                <p class="text-xs text-gray-500">(Based on <span id="output-ltvDisplayRenewal">--</span>-month LTV)</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Year 2 Revenue</p>
                                <p class="text-xl font-bold text-purple-800" id="output-year2TotalRevenue">$--</p>
                                <p class="text-xs text-gray-500">(New Deals + Renewals)</p>
                            </div>
                             <div>
                                <p class="text-sm text-gray-600">Year 2 Gross Profit</p>
                                <p class="text-xl font-bold text-purple-700" id="output-year2GrossProfit">$--</p>
                                <p class="text-xs text-gray-500">(Based on <span id="output-grossMarginDisplayY2">--</span>% Margin)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
                    <div class="bg-white p-4 rounded-lg shadow-sm result-section-card">
                        <h3 class="text-lg font-medium text-blue-900 mb-2">Year 1 Financial Analysis</h3>
                        <div class="result-content space-y-3">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                <div>
                                    <p class="text-sm text-gray-600">Est. Monthly OTE Compensation (Team)</p>
                                    <p class="text-lg font-bold" id="output-monthlySDRCompensationTeam">$--</p>
                                </div>
                                 <div>
                                    <p class="text-sm text-gray-600">Avg. Monthly SaaS Cost (Team)</p>
                                    <p class="text-lg font-bold" id="output-monthlySaaSCostTeam">$--</p>
                                </div>
                            </div>

                            <hr class="separator"/>
                            <div id="operational-overheads-section" class="p-3 rounded-md bg-indigo-50" style="display: none;">
                                <h4 class="text-md font-semibold text-indigo-800 mb-2">Operational Overheads (Annual)</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                    <div id="output-total-fractional-sales-cost-section" style="display: none;">
                                        <p class="text-sm text-gray-600">Total Annual Fractional Sales Management Cost</p>
                                        <p class="text-lg font-bold" id="output-total-annual-fractional-sales-cost">$--</p>
                                        <p class="text-xs text-gray-500" id="output-fractional-sales-cost-calc-note">(Onboarding + Ongoing)</p>
                                   </div>
                                    <div id="output-total-hr-payroll-overheads-section" style="display: none;">
                                        <p class="text-sm text-gray-600">Total Annual HR & Payroll Overheads</p>
                                        <p class="text-lg font-bold" id="output-total-annual-hr-payroll-overheads">$--</p>
                                        <p class="text-xs text-gray-500" id="output-hr-payroll-overheads-calc-note">($--/SDR/mo x -- SDRs x 12)</p>
                                    </div>
                                </div>
                            </div>

                            <hr class="separator" id="operational-overheads-separator" style="display: none;"/>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                <div>
                                    <p class="text-sm font-medium text-gray-700">Total Avg. Monthly Cost (Year 1)</p>
                                    <p class="text-lg font-bold text-indigo-700" id="output-monthlyTotalCost">$--</p>
                                    <p class="text-xs text-gray-500" id="output-monthly-total-cost-note">(Avg. SDR Comp + SaaS + Opt. Overheads)</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Total Year 1 Investment</p>
                                    <p class="text-lg font-bold" id="output-annualInvestment">$--</p>
                                </div>
                            </div>

                        </div>
                        <hr class="separator"/>
                        <div class="mt-1 mb-2"> <h4 class="text-md font-semibold text-blue-800 mb-2 text-center">Year 1 Financial Overview Chart</h4>
                            <div style="position: relative; height:300px; width:100%;"> <canvas id="year1FinancialChart"></canvas>
                            </div>
                             <p class="text-xs text-gray-600 mt-3 text-center px-2">
                                 Chart shows Cumulative Investment vs. Cumulative Gross Profit. Breakeven is where Gross Profit meets Investment.
                             </p>
                        </div>
                    </div>

                    <div class="bg-emerald-100 p-4 rounded-lg shadow-md result-section-card">
                        <h3 class="text-lg font-medium text-blue-900 mb-2">Return on Investment (ROI)</h3>
                        <div class="result-content space-y-4">
                            <div class="pb-3 border-b border-gray-300 space-y-3">
                                <h4 class="text-md font-semibold text-blue-800 mb-2">Year 1 ROI</h4>
                                <div>
                                    <p class="text-sm text-gray-700">Total Year 1 Investment</p>
                                    <p class="text-lg font-bold text-blue-900" id="output-year1InvestmentDisplayROI">$--</p>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                    <div>
                                        <p class="text-sm text-gray-700">Year 1 Gross Profit</p>
                                        <p class="text-xl font-semibold text-emerald-700" id="output-year1GrossProfitDisplayROI">$--</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-700">Year 1 ROI</p>
                                        <p class="text-xl font-semibold text-emerald-700" id="output-year1ROI">--%</p>
                                        <p class="text-xs text-gray-600">(Based on Y1 Gross Profit vs Y1 Investment)</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                    <div id="output-lifetimeValue1-section" class="hidden">
                                        <p class="text-sm text-gray-600">Lifetime Value of Y1 New Deals (Revenue)</p>
                                        <p class="text-lg font-bold text-blue-800" id="output-year1CustomerValue">$--</p>
                                        <p class="text-xs text-gray-600">(Y1 Deals x Deal Size x <span id="output-ltvDisplayValue1">--</span>m LTV Multiplier)</p>
                                   </div>
                                    <div id="output-lifetimeROI1-section" class="hidden">
                                        <p class="text-sm text-gray-600">Year 1 Lifetime ROI (based on LTV Revenue)</p>
                                        <p class="text-xl font-bold text-blue-800" id="output-lifetimeROI_Year1">--%</p>
                                        <p class="text-xs text-gray-600">(LTV Revenue of Y1 Deals vs Y1 Investment)</p>
                                    </div>
                                </div>
                                <div class="mt-3" id="year1-roi-visual-container"> 
                                    <div style="position: relative; height:110px; width:100%;"> <canvas id="year1ROIPercentageChart"></canvas></div>
                                 </div>
                            </div> 
                            <div class="space-y-3 pt-3"> <h4 class="text-md font-semibold text-purple-800 mb-2">Year 2 ROI</h4>
                                 <div>
                                    <p class="text-sm text-gray-700">Total Year 2 Investment</p>
                                    <p class="text-lg font-bold text-blue-900" id="output-year2InvestmentDisplayROI">$--</p>
                                     <p class="text-xs text-gray-600" id="output-year2-investment-note">(SDR Comp + SaaS + Opt. Overheads)</p>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                    <div>
                                        <p class="text-sm text-gray-700">Year 2 Gross Profit</p>
                                        <p class="text-xl font-semibold text-emerald-700" id="output-year2GrossProfitDisplayROI">$--</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-700">Year 2 ROI</p>
                                        <p class="text-xl font-semibold text-emerald-700" id="output-year2ROI">--%</p>
                                        <p class="text-xs text-gray-600">(Based on Y2 Gross Profit vs Y2 Investment)</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                                    <div id="output-lifetimeValue2-section" class="hidden">
                                        <p class="text-sm text-gray-600">Lifetime Value of Y2 New Deals (Revenue)</p>
                                        <p class="text-lg font-bold text-purple-700" id="output-year2CustomerValue">$--</p>
                                        <p class="text-xs text-gray-600">(Y2 Deals x Deal Size x <span id="output-ltvDisplayValue2">--</span>m LTV Multiplier)</p>
                                    </div>
                                     <div id="output-lifetimeROI2-section" class="hidden">
                                        <p class="text-sm text-gray-600">Year 2 Lifetime ROI (based on LTV Revenue)</p>
                                        <p class="text-xl font-bold text-purple-700" id="output-lifetimeROI_Year2">--%</p>
                                        <p class="text-xs text-gray-600">(LTV Revenue of Y2 Deals vs Y2 Investment)</p>
                                    </div>
                                </div>
                                <div class="mt-3" id="year2-roi-visual-container"> 
                                    <div style="position: relative; height:110px; width:100%;"> <canvas id="year2ROIPercentageChart"></canvas></div>
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <div class="flex flex-col sm:flex-row gap-3 mb-4">
                        <button id="toggle-explanations" type="button" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded transition duration-300 text-sm shadow-md">
                            Show Calculation Explanations
                        </button>
                        <button id="download-pdf-button" type="button" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded transition duration-300 text-sm shadow-md">
                            Download Results as PDF
                        </button>
                    </div>

                    <div id="explanation-content" class="explanation-content bg-gray-100 p-4 rounded-lg shadow-inner border border-gray-200">
                        <h3 class="text-md font-semibold text-gray-800 mb-3">Calculation Notes</h3>
                        <div class="space-y-2 text-xs text-gray-700">
                            <p><strong>SDR Compensation:</strong> Includes Monthly Salary Package (incl. Superannuation) and Monthly Variable Commission (On-Target Earnings component).</p>
                            <p><strong>Monthly/Annual Leads:</strong> SDRs x Leads/SDR/Month. Ramp-up (if selected) assumes 50% productivity for months 1-3, then 100% from month 4.</p>
                            <p><strong>Pipeline Generated:</strong> Annual Leads (Year 1) x Average Deal Size (Revenue).</p>
                            <p><strong>New Deals & Revenue Realization:</strong> Calculated monthly based on leads generated <code id="exp-sales-cycle">--</code> months prior, using the <code id="exp-conversion-rate">--</code>% conversion rate. Revenue shown is total deal value.</p>
                            <p><strong>Gross Profit:</strong> Calculated as Total Revenue x Average Gross Margin (%). This is the profit figure used for ROI and Breakeven calculations against investments.</p>
                            <p><strong>Year 1 vs Year 2:</strong> Metrics are aggregated based on when new deals *close* (Month 1-12 for Year 1, Month 13-24 for Year 2).</p>
                            <p><strong>Est. Revenue from Y1 Leads Closing in Y2:</strong> Total revenue value of Year 1 leads expected to close in Year 2 due to sales cycle delay.</p>
                            <p><strong>Fractional Sales Management Costs:</strong> If included, the "Monthly Cost for 4-Month Onboarding & Training Support" is applied each month for the first 4 months. "Ongoing Fractional Management Support" costs are then applied monthly for the selected duration, starting after this initial 4-month onboarding period.</p>
                            <p><strong>Year 1 Investment:</strong> Sum of 12 months of Total SDR Compensation (Salary Pkg + Commission), SaaS Costs, and any included Fractional Sales Management costs (onboarding + applicable ongoing portion for Y1) and HR & Payroll Overheads.</p>
                            <p><strong>Year 2 Investment:</strong> Sum of 12 months of Total SDR Compensation, SaaS Costs, and any included Fractional Sales Management costs (ongoing portion applicable to Y2) and HR & Payroll Overheads (assumed to continue at the same rate as Year 1).</p>
                            <p><strong>Avg. Monthly Costs (Year 1):</strong> Total Year 1 Investment divided by 12. Includes all components of SDR compensation, SaaS, and allocated portions of Fractional Sales Management and HR/Payroll overheads if selected.</p>
                            <p><strong>Operational Overheads (Annual):</strong> Shows total annual costs for Fractional Sales Management (onboarding + Y1 ongoing portion) and HR & Payroll overheads if these options are included.</p>
                            <p><strong>Cost Per Lead (CPL):</strong> Total Year 1 Investment ÷ Year 1 Qualified Leads.</p>
                            <p><strong>Cost Per Acquisition (CPA):</strong> Total Year 1 Investment ÷ Year 1 New Deals Closed.</p>
                            <p><strong>Year 1 ROI:</strong> ((Year 1 Total Gross Profit - Year 1 Investment) / Year 1 Investment) x 100%.</p>
                            <p><strong>Year 2 ROI:</strong> ((Year 2 Total Gross Profit - Year 2 Investment) / Year 2 Investment) x 100%.</p>
                            <p><strong>Lifetime Value (LTV) Basis:</strong> Adjusts calculations for renewal revenue and lifetime ROI. 18m = 1.5x multiplier, 24m = 2x multiplier on initial deal *revenue* for LTV calculations.</p>
                            <p><strong>Lifetime ROI (based on LTV Revenue):</strong> ((Total LTV Revenue of New Deals Closed in Period - Investment in Period) / Investment in Period) x 100%. Note: This specific ROI uses LTV *Revenue* against investment, distinct from the primary ROI which uses Gross Profit.</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="mt-10 pt-5 border-t border-gray-300 text-center text-gray-500 text-xs">
            <p>Disclaimer: This calculator provides estimates based on the parameters entered. Actual results can vary based on market conditions, execution, team performance, and other factors not captured here.</p>
            <p class="mt-2">© <span id="copyright-year">2025</span> | Sales Development Team Setup ROI Calculator</p>
        </div>
    </div>

    <script>
        // --- Helper Function to display non-blocking error messages ---
        function showErrorMessage(message) {
            const errorBox = document.getElementById('error-message-box');
            const errorText = document.getElementById('error-message-text');
            if (errorBox && errorText) {
                errorText.textContent = message;
                errorBox.classList.remove('hidden');
                errorBox.style.opacity = '1'; // Ensure it's visible
                setTimeout(() => {
                    errorBox.style.opacity = '0'; // Fade out
                    setTimeout(() => errorBox.classList.add('hidden'), 500); // Hide after fade
                }, 5000); // Display for 5 seconds
            }
        }

        // --- Helper Function to format numbers ---
        function formatNumber(num) {
            if (num === undefined || num === null || isNaN(num) || !isFinite(num)) return "--";
            const numValue = Number(num);
            return new Intl.NumberFormat('en-US').format(numValue);
        }
         function formatPercentage(num) {
            if (num === undefined || num === null || isNaN(num) || !isFinite(num)) return "--%";
            return Math.round(num) + '%';
        }


        // --- DOM Element References ---
        const form = document.getElementById('roi-form');
        const inputs = {
            numberOfSDRs: document.getElementById('numberOfSDRs'),
            sdrMonthlySalary: document.getElementById('sdrMonthlySalary'), 
            sdrVariableCommission: document.getElementById('sdrVariableCommission'),
            leadsPerSDRMonth: document.getElementById('leadsPerSDRMonth'),
            monthlySaasTools: document.getElementById('monthlySaasTools'), 
            includeFractionalSalesManagement: document.getElementById('includeFractionalSalesManagement'), 
            fractionalOnboardingCost: document.getElementById('fractionalOnboardingCost'), 
            includeOngoingFractionalSupport: document.getElementById('includeOngoingFractionalSupport'), 
            ongoingFractionalDuration: document.getElementById('ongoingFractionalDuration'), 
            ongoingFractionalMonthlyCost: document.getElementById('ongoingFractionalMonthlyCost'), 
            includeHRPayrollOverheads: document.getElementById('includeHRPayrollOverheads'),
            hrPayrollOverheadsPerSDR: document.getElementById('hrPayrollOverheadsPerSDR'), 
            averageDealSize: document.getElementById('averageDealSize'), 
            averageGrossMargin: document.getElementById('averageGrossMargin'), 
            averageSalesCycle: document.getElementById('averageSalesCycle'), 
            leadConversionRate: document.getElementById('leadConversionRate'), 
            isTeamFullyRamped: document.getElementById('isTeamFullyRamped'),
            customerLifetimeValue: document.getElementById('customerLifetimeValue'), 
        };
        const fractionalSalesInputsContainer = document.getElementById('fractional-sales-inputs-container'); 
        const ongoingFractionalSupportContainer = document.getElementById('ongoing-fractional-support-container'); 
        const hrPayrollInputsContainer = document.getElementById('hr-payroll-inputs-container');
        const rampUpNote = document.getElementById('ramp-up-note');
        const outputs = {
            totalSDRCompensationPerSDR: document.getElementById('output-totalSDRCompensationPerSDR'), 
            monthlyLeads: document.getElementById('output-monthlyLeads'),
            monthlyLeadsNote: document.getElementById('output-monthlyLeads-note'),
            annualLeads: document.getElementById('output-annualLeads'),
            annualLeadsNote: document.getElementById('output-annualLeads-note'),
            costPerLead: document.getElementById('output-costPerLead'),
            cplNote: document.getElementById('output-cpl-note'),
            costPerAcquisition: document.getElementById('output-costPerAcquisition'),
            cpaNote: document.getElementById('output-cpa-note'),
            annualPipeline: document.getElementById('output-annualPipeline'),
            firstRevenueMonth: document.getElementById('output-firstRevenueMonth'),
            firstRevenueAmount: document.getElementById('output-firstRevenueAmount'),
            salesCycleDisplay: document.getElementById('output-salesCycleDisplay'),
            year1Deals: document.getElementById('output-year1Deals'),
            conversionRateDisplay: document.getElementById('output-conversionRateDisplay'),
            year1Revenue: document.getElementById('output-year1Revenue'),
            year1GrossProfit: document.getElementById('output-year1GrossProfit'), 
            grossMarginDisplayY1: document.getElementById('output-grossMarginDisplayY1'), 
            unrealizedRevenueY2: document.getElementById('output-unrealizedRevenueY2'),
            year2Deals: document.getElementById('output-year2Deals'),
            year2Revenue: document.getElementById('output-year2Revenue'), 
            year2GrossProfit: document.getElementById('output-year2GrossProfit'), 
            grossMarginDisplayY2: document.getElementById('output-grossMarginDisplayY2'), 
            renewalSection: document.getElementById('output-renewal-section'),
            year1RenewalRevenue: document.getElementById('output-year1RenewalRevenue'),
            ltvDisplayRenewal: document.getElementById('output-ltvDisplayRenewal'),
            year2TotalRevenue: document.getElementById('output-year2TotalRevenue'), 
            monthlySDRCompensationTeam: document.getElementById('output-monthlySDRCompensationTeam'), 
            monthlySaaSCostTeam: document.getElementById('output-monthlySaaSCostTeam'),
            operationalOverheadsSection: document.getElementById('operational-overheads-section'),
            operationalOverheadsSeparator: document.getElementById('operational-overheads-separator'),
            totalFractionalSalesCostSection: document.getElementById('output-total-fractional-sales-cost-section'), 
            totalAnnualFractionalSalesCost: document.getElementById('output-total-annual-fractional-sales-cost'), 
            fractionalSalesCostCalcNote: document.getElementById('output-fractional-sales-cost-calc-note'), 
            totalHRPayrollOverheadsSection: document.getElementById('output-total-hr-payroll-overheads-section'),
            totalAnnualHRPayrollOverheads: document.getElementById('output-total-annual-hr-payroll-overheads'),
            hrPayrollOverheadsCalcNote: document.getElementById('output-hr-payroll-overheads-calc-note'),
            monthlyTotalCost: document.getElementById('output-monthlyTotalCost'),
            monthlyTotalCostNote: document.getElementById('output-monthly-total-cost-note'),
            annualInvestment: document.getElementById('output-annualInvestment'),
            year1ROI: document.getElementById('output-year1ROI'),
            year1InvestmentDisplayROI: document.getElementById('output-year1InvestmentDisplayROI'),
            year1GrossProfitDisplayROI: document.getElementById('output-year1GrossProfitDisplayROI'), 
            lifetimeROI1Section: document.getElementById('output-lifetimeROI1-section'),
            lifetimeROI_Year1: document.getElementById('output-lifetimeROI_Year1'),
            ltvDisplayValue1: document.getElementById('output-ltvDisplayValue1'),
            lifetimeValue1Section: document.getElementById('output-lifetimeValue1-section'),
            year1CustomerValue: document.getElementById('output-year1CustomerValue'),
            year2ROI: document.getElementById('output-year2ROI'),
            year2InvestmentDisplayROI: document.getElementById('output-year2InvestmentDisplayROI'),
            year2GrossProfitDisplayROI: document.getElementById('output-year2GrossProfitDisplayROI'), 
            year2InvestmentNote: document.getElementById('output-year2-investment-note'),
            lifetimeROI2Section: document.getElementById('output-lifetimeROI2-section'),
            lifetimeROI_Year2: document.getElementById('output-lifetimeROI_Year2'),
            ltvDisplayValue2: document.getElementById('output-ltvDisplayValue2'),
            lifetimeValue2Section: document.getElementById('output-lifetimeValue2-section'),
            year2CustomerValue: document.getElementById('output-year2CustomerValue'),
        };
        const explanationContent = document.getElementById('explanation-content');
        const toggleExplanationsButton = document.getElementById('toggle-explanations');
        const downloadPdfButton = document.getElementById('download-pdf-button');
        const pdfContentArea = document.getElementById('pdf-content-area');
        const expSalesCycle = document.getElementById('exp-sales-cycle');
        const expConversionRate = document.getElementById('exp-conversion-rate');
        document.getElementById('copyright-year').textContent = new Date().getFullYear();

        // --- Chart.js Setup ---
        let year1ChartInstance = null;
        let year1ROIPercentageChartInstance = null;
        let year2ROIPercentageChartInstance = null;

        if (window.Chart && window.Chart.register && window.ChartAnnotation) {
            try {
                window.Chart.register(window.ChartAnnotation);
            } catch (e) {
                console.error("Error registering ChartAnnotation plugin:", e);
                showErrorMessage("Chart plugin could not be registered. Charts might not display correctly.");
            }
        } else {
            console.warn('Chart.js or ChartAnnotation plugin not fully loaded. Financial chart might not render with all features.');
        }

        function updateYear1FinancialChart(labels, investmentData, grossProfitData, cumulativeNetProfitData, breakevenMonthValue) {
            const ctx = document.getElementById('year1FinancialChart');
            if (!ctx) { console.error('Canvas element for year1FinancialChart not found.'); return; }
            if (!window.Chart) { console.error('Chart.js is not loaded.'); showErrorMessage('Charting library not available.'); return; }
            if (year1ChartInstance) { year1ChartInstance.destroy(); }

            const breakevenAnnotations = [];
            const numericBreakevenMonth = parseInt(breakevenMonthValue); 
            // Check if breakevenMonth is a valid month number (1-12 for Year 1 chart)
            if (!isNaN(numericBreakevenMonth) && numericBreakevenMonth > 0 && numericBreakevenMonth <= 12) {
                breakevenAnnotations.push({
                    type: 'line', xMin: numericBreakevenMonth - 1, xMax: numericBreakevenMonth - 1, // 0-indexed for labels
                    borderColor: 'rgba(220, 53, 69, 0.8)', borderWidth: 2, borderDash: [5, 5],
                    label: { content: 'Breakeven', enabled: true, position: 'start', backgroundColor: 'rgba(220, 53, 69, 0.7)', font: { weight: 'bold', size: 10 }, color: 'white', padding: 4, yAdjust: -15 }
                });
            }
            year1ChartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: [
                    { label: 'Cumulative Investment', data: investmentData, borderColor: 'rgb(255, 99, 132)', backgroundColor: 'rgba(255, 99, 132, 0.1)', tension: 0.1, fill: true, yAxisID: 'y' },
                    { label: 'Cumulative Gross Profit', data: grossProfitData, borderColor: 'rgb(75, 192, 192)', backgroundColor: 'rgba(75, 192, 192, 0.1)', tension: 0.1, fill: true, yAxisID: 'y' },
                    { label: 'Cumulative Net Profit/Loss', data: cumulativeNetProfitData, borderColor: 'rgb(54, 162, 235)', backgroundColor: 'rgba(54, 162, 235, 0.1)', tension: 0.1, fill: false, yAxisID: 'y' }
                ]},
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
                    scales: { 
                        x: { 
                            display: true, 
                            title: { display: true, text: 'Month' },
                        },
                        y: { 
                            display: true, 
                            title: { display: true, text: 'Amount (AUD)' }, 
                            beginAtZero: false, 
                            ticks: { callback: function(value) { return '$' + formatNumber(value); } } 
                        }
                    },
                    plugins: { tooltip: { callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.parsed.y !== null) { label += '$' + formatNumber(Math.round(context.parsed.y)); } return label; } } },
                        annotation: { annotations: breakevenAnnotations.length > 0 ? breakevenAnnotations : {} }, 
                        legend: { position: 'top' }, title: { display: false }
                    }
                }
            });
        }

        function updateYear1ROIPercentageChart(year1ROIValue, lifetimeROI_Year1Value, year1InvestmentValue, isLifetimeApplicable) {
            const ctx = document.getElementById('year1ROIPercentageChart');
            if (!ctx) { console.error('Canvas for year1ROIPercentageChart not found.'); return; }
            if (!window.Chart) { console.error('Chart.js not loaded for ROI chart.'); return; }
            if (year1ROIPercentageChartInstance) { year1ROIPercentageChartInstance.destroy(); }

            const labels = ['Direct ROI (Gross Profit Based)'];
            const data = [isNaN(year1ROIValue) || !isFinite(year1ROIValue) ? 0 : year1ROIValue];
            const backgroundColors = ['rgba(75, 192, 192, 0.6)']; 
            const borderColors = ['rgb(75, 192, 192)'];

            if (isLifetimeApplicable) {
                labels.push('Lifetime ROI (LTV Revenue Based)');
                data.push(isNaN(lifetimeROI_Year1Value) || !isFinite(lifetimeROI_Year1Value) ? 0 : lifetimeROI_Year1Value);
                backgroundColors.push('rgba(54, 162, 235, 0.6)'); 
                borderColors.push('rgb(54, 162, 235)');
            }

            year1ROIPercentageChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ROI %',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 0.8,
                        barThickness: 20, 
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: { display: true, text: 'Percentage (%)' },
                            ticks: {
                                callback: function(value) { return value + '%'; },
                                font: { size: 10 }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { font: { size: 10 } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.parsed.x !== null) { label += formatPercentage(context.parsed.x); } return label; } } },
                        title: { display: false }
                    }
                }
            });
        }

        function updateYear2ROIPercentageChart(year2ROIValue, lifetimeROI_Year2Value, year2InvestmentValue, isLifetimeApplicable) {
            const ctx = document.getElementById('year2ROIPercentageChart');
            if (!ctx) { console.error('Canvas element for year2ROIPercentageChart not found.'); return; }
            if (!window.Chart) { console.error('Chart.js is not loaded. Cannot render Year 2 ROI percentage chart.'); return; }

            if (year2ROIPercentageChartInstance) {
                year2ROIPercentageChartInstance.destroy();
            }

            const labels = ['Direct ROI (Gross Profit Based)'];
            const data = [isNaN(year2ROIValue) || !isFinite(year2ROIValue) ? 0 : year2ROIValue];
            const backgroundColors = ['rgba(153, 102, 255, 0.6)']; 
            const borderColors = ['rgb(153, 102, 255)'];

            if (isLifetimeApplicable) {
                labels.push('Lifetime ROI (LTV Revenue Based)');
                data.push(isNaN(lifetimeROI_Year2Value) || !isFinite(lifetimeROI_Year2Value) ? 0 : lifetimeROI_Year2Value);
                backgroundColors.push('rgba(255, 159, 64, 0.6)'); 
                borderColors.push('rgb(255, 159, 64)');
            }

            year2ROIPercentageChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ROI %',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 0.8,
                        barThickness: 20,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: { display: true, text: 'Percentage (%)' },
                            ticks: {
                                callback: function(value) { return value + '%'; },
                                font: { size: 10 }
                            }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { font: { size: 10 } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.parsed.x !== null) { label += formatPercentage(context.parsed.x); } return label; } } },
                        title: { display: false }
                    }
                }
            });
        }


        // --- Calculation Logic ---
        function calculateROI() {
            // Get all input values, parsing them to numbers and providing defaults if empty/invalid
            const numberOfSDRs = parseInt(inputs.numberOfSDRs.value) || 0;
            const sdrMonthlySalaryPkg = parseFloat(inputs.sdrMonthlySalary.value) || 0;
            const sdrVariableCommission = parseFloat(inputs.sdrVariableCommission.value) || 0;
            const totalMonthlyCompPerSDR = sdrMonthlySalaryPkg + sdrVariableCommission;

            const leadsPerSDRMonth = parseInt(inputs.leadsPerSDRMonth.value) || 0;
            const monthlySaasToolsPerSDR = parseFloat(inputs.monthlySaasTools.value) || 0;

            const includeFractionalSales = inputs.includeFractionalSalesManagement.checked;
            const monthlyFractionalOnboardingCost = includeFractionalSales ? (parseFloat(inputs.fractionalOnboardingCost.value) || 0) : 0; 
            const includeOngoingFractional = includeFractionalSales ? inputs.includeOngoingFractionalSupport.checked : false;
            const ongoingFractionalDurationMonths = (includeFractionalSales && includeOngoingFractional) ? (parseInt(inputs.ongoingFractionalDuration.value) || 0) : 0;
            const ongoingFractionalMonthlyCostValue = (includeFractionalSales && includeOngoingFractional) ? (parseFloat(inputs.ongoingFractionalMonthlyCost.value) || 0) : 0;
            
            const includeHRPayrollOverheads = inputs.includeHRPayrollOverheads.checked;
            const hrPayrollOverheadsPerSDR = includeHRPayrollOverheads ? (parseFloat(inputs.hrPayrollOverheadsPerSDR.value) || 0) : 0;

            const averageDealSize = parseFloat(inputs.averageDealSize.value) || 0;
            const averageGrossMargin = parseFloat(inputs.averageGrossMargin.value) || 0; 
            const averageSalesCycle = parseInt(inputs.averageSalesCycle.value) || 0; 
            const leadConversionRate = parseFloat(inputs.leadConversionRate.value) || 0; 
            const isTeamFullyRamped = inputs.isTeamFullyRamped.checked;
            const customerLifetimeValue = inputs.customerLifetimeValue.value; 

            // Calculate base monthly costs for the SDR team
            const monthlySDRTeamTotalCompensation = numberOfSDRs * totalMonthlyCompPerSDR;
            const monthlySaaSTeamCost = numberOfSDRs * monthlySaasToolsPerSDR;
            const monthlyHRPayrollOverheadsTeamCost = includeHRPayrollOverheads ? hrPayrollOverheadsPerSDR * numberOfSDRs : 0;
            
            const baseMonthlyCostForAllSDRs = monthlySDRTeamTotalCompensation + monthlySaaSTeamCost + monthlyHRPayrollOverheadsTeamCost;

            // Calculate Year 1 monthly operating costs, including fractional sales costs
            let year1MonthlyOperatingCosts = Array(12).fill(baseMonthlyCostForAllSDRs);
            let totalAnnualFractionalSalesCostY1 = 0;

            if (includeFractionalSales) {
                // Add onboarding costs for the first 4 months
                for (let m = 0; m < 4; m++) { 
                    if (m < 12) { // Ensure it's within Year 1
                        year1MonthlyOperatingCosts[m] += monthlyFractionalOnboardingCost;
                        totalAnnualFractionalSalesCostY1 += monthlyFractionalOnboardingCost;
                    }
                }
                // Add ongoing fractional costs if applicable
                if (includeOngoingFractional) {
                    for (let m = 0; m < ongoingFractionalDurationMonths; m++) {
                        const currentOverallMonthIndex = 4 + m; // Ongoing starts after 4 months onboarding
                        if (currentOverallMonthIndex < 12) { // Ensure it's within Year 1
                            year1MonthlyOperatingCosts[currentOverallMonthIndex] += ongoingFractionalMonthlyCostValue;
                            totalAnnualFractionalSalesCostY1 += ongoingFractionalMonthlyCostValue;
                        }
                    }
                }
            }
            
            const year1Investment = year1MonthlyOperatingCosts.reduce((sum, cost) => sum + cost, 0);
            
            // Calculate Year 2 investment (assumes base costs + any ongoing fractional costs falling in Y2)
            let year2FractionalOngoingCostTotal = 0;
            if (includeFractionalSales && includeOngoingFractional) {
                for (let m = 0; m < ongoingFractionalDurationMonths; m++) {
                    const ongoingCostOverallMonthIndex = 4 + m; // Overall month index from start of engagement
                    if (ongoingCostOverallMonthIndex >= 12 && ongoingCostOverallMonthIndex < 24) { // Cost falls in Year 2
                        year2FractionalOngoingCostTotal += ongoingFractionalMonthlyCostValue;
                    }
                }
            }
            const year2Investment = (baseMonthlyCostForAllSDRs * 12) + year2FractionalOngoingCostTotal;

            // Calculate monthly leads generated over 24 months, considering ramp-up
            let monthlyLeadsArray = Array(24).fill(0); 
            const fullyRampedMonthlyLeads = numberOfSDRs * leadsPerSDRMonth;
            const isRampingUp = !isTeamFullyRamped && numberOfSDRs > 0; 

            if (isTeamFullyRamped || numberOfSDRs === 0) { 
                monthlyLeadsArray.fill(fullyRampedMonthlyLeads); 
            } else { 
                const rampingProductivity = 0.50; // 50% productivity during ramp-up
                for (let i = 0; i < 24; i++) {
                    if (i < 3) { // First 3 months are ramp-up
                        monthlyLeadsArray[i] = fullyRampedMonthlyLeads * rampingProductivity;
                    } else { 
                        monthlyLeadsArray[i] = fullyRampedMonthlyLeads;
                    }
                }
            }
            const totalAnnualLeadsYear1 = monthlyLeadsArray.slice(0, 12).reduce((sum, leads) => sum + leads, 0);
            const annualPipelineYear1 = totalAnnualLeadsYear1 * averageDealSize;

            // Calculate monthly deals, revenue, and gross profit over an extended period (36 months to cover sales cycles)
            let monthlyDealsArray = Array(36).fill(0);        
            let monthlyRevenueArray = Array(36).fill(0);       
            let monthlyGrossProfitArray = Array(36).fill(0); 

            for (let leadGenMonth = 0; leadGenMonth < 24; leadGenMonth++) { // For leads generated in the first 2 years
                const leadsInMonth = monthlyLeadsArray[leadGenMonth];
                const dealsFromThisMonthsLeads = leadsInMonth * (leadConversionRate / 100);
                const revenueFromThisMonthsLeads = dealsFromThisMonthsLeads * averageDealSize;
                const grossProfitFromThisMonthsLeads = revenueFromThisMonthsLeads * (averageGrossMargin / 100);
                
                const realizationMonthIndex = leadGenMonth + averageSalesCycle; // When revenue from these leads is realized

                if (realizationMonthIndex < monthlyRevenueArray.length) { 
                    monthlyDealsArray[realizationMonthIndex] += dealsFromThisMonthsLeads;
                    monthlyRevenueArray[realizationMonthIndex] += revenueFromThisMonthsLeads;
                    monthlyGrossProfitArray[realizationMonthIndex] += grossProfitFromThisMonthsLeads;
                }
            }

            // Aggregate Year 1 and Year 2 performance metrics
            let year1Deals = 0, year1Revenue = 0, year1GrossProfit = 0;
            let year2Deals = 0, year2NewRevenue = 0, year2NewGrossProfit = 0; 

            for (let month = 0; month < 12; month++) { // Months 0-11 (Year 1)
                year1Deals += monthlyDealsArray[month]; 
                year1Revenue += monthlyRevenueArray[month]; 
                year1GrossProfit += monthlyGrossProfitArray[month];
            }
            for (let month = 12; month < 24; month++) { // Months 12-23 (Year 2)
                year2Deals += monthlyDealsArray[month]; 
                year2NewRevenue += monthlyRevenueArray[month]; 
                year2NewGrossProfit += monthlyGrossProfitArray[month];
            }

            // Calculate unrealized revenue from Y1 leads that close in Y2
            let unrealizedRevenueY2 = 0; 
            for (let leadGenMonth = 0; leadGenMonth < 12; leadGenMonth++) { // For leads generated in Year 1
                const revenueRealizationMonthIndex = leadGenMonth + averageSalesCycle;
                if (revenueRealizationMonthIndex >= 12 && revenueRealizationMonthIndex < 24) { // If revenue realized in Year 2
                    const leadsInGenMonth = monthlyLeadsArray[leadGenMonth];
                    const dealsFromLeads = leadsInGenMonth * (leadConversionRate / 100);
                    unrealizedRevenueY2 += dealsFromLeads * averageDealSize;
                }
            }

            // Calculate cumulative costs and profits for breakeven analysis and charting (Year 1)
            let cumulativeCost = 0, cumulativeGrossProfit = 0, breakevenMonth = -1;
            const chartLabels = Array.from({ length: 12 }, (_, i) => `M${i + 1}`); 
            const cumulativeInvestmentDataY1 = Array(12).fill(0);
            const cumulativeGrossProfitDataY1 = Array(12).fill(0);
            const cumulativeNetProfitDataY1 = Array(12).fill(0); 

            for (let month = 0; month < 36; month++) { // Iterate over an extended period to find breakeven
                let costThisMonth;
                if (month < 12) { // Year 1 costs
                    costThisMonth = year1MonthlyOperatingCosts[month]; 
                } else { // Post-Year 1 costs (base + any ongoing fractional)
                    costThisMonth = baseMonthlyCostForAllSDRs; 
                    if (includeFractionalSales && includeOngoingFractional) {
                        const ongoingPhaseStartMonthIndex = 4; // Start of ongoing fractional (month 5 overall)
                        const ongoingPhaseEndMonthIndex = 4 + ongoingFractionalDurationMonths -1; // End of ongoing fractional
                        if (month >= ongoingPhaseStartMonthIndex && month <= ongoingPhaseEndMonthIndex) {
                            costThisMonth += ongoingFractionalMonthlyCostValue;
                        }
                    }
                }
                cumulativeCost += costThisMonth;
                cumulativeGrossProfit += monthlyGrossProfitArray[month]; 
                
                if (month < 12) { // Store data for Year 1 chart
                    cumulativeInvestmentDataY1[month] = cumulativeCost; 
                    cumulativeGrossProfitDataY1[month] = cumulativeGrossProfit;
                    cumulativeNetProfitDataY1[month] = cumulativeGrossProfit - cumulativeCost;
                }

                if (cumulativeGrossProfit >= cumulativeCost && breakevenMonth === -1) { 
                    breakevenMonth = month + 1; // 1-indexed month
                }
            }
            const displayBreakeven = breakevenMonth === -1 ? "36+" : breakevenMonth; // If not broken even within 36 months

            // Find first month of revenue
            let firstRevenueMonth = 0, firstRevenueAmount = 0;
            for (let month = 0; month < monthlyRevenueArray.length; month++) {
                if (monthlyRevenueArray[month] > 0) { 
                    firstRevenueMonth = month + 1; // 1-indexed month
                    firstRevenueAmount = monthlyRevenueArray[month]; 
                    break; 
                }
            }

            // Calculate renewal revenue based on LTV selection
            let year1RenewalRevenue = 0; 
            let lifetimeMultiplier = 1;
            const customerLifetimeValueNum = parseInt(customerLifetimeValue); 
            if (!isNaN(customerLifetimeValueNum) && customerLifetimeValueNum > 12) {
                if (customerLifetimeValueNum === 18) { 
                    year1RenewalRevenue = year1Deals * averageDealSize * 0.5; // 50% of Y1 deal value as renewal
                    lifetimeMultiplier = 1.5; 
                } else if (customerLifetimeValueNum === 24) { 
                    year1RenewalRevenue = year1Deals * averageDealSize * 1.0; // 100% of Y1 deal value as renewal
                    lifetimeMultiplier = 2; 
                }
            }
            const year2TotalRevenue = year2NewRevenue + year1RenewalRevenue; 
            const year2TotalGrossProfit = year2NewGrossProfit + (year1RenewalRevenue * (averageGrossMargin / 100)); 

            // Calculate CPL and CPA
            const costPerLead = totalAnnualLeadsYear1 > 0 ? year1Investment / totalAnnualLeadsYear1 : 0;
            const costPerAcquisition = year1Deals > 0 ? year1Investment / year1Deals : 0;
            
            // Calculate ROI percentages
            const year1ROI = year1Investment > 0 ? ((year1GrossProfit - year1Investment) / year1Investment) * 100 : (year1GrossProfit > 0 ? Infinity : 0);
            const year2ROI = year2Investment > 0 ? ((year2TotalGrossProfit - year2Investment) / year2Investment) * 100 : (year2TotalGrossProfit > 0 ? Infinity : 0);
            
            // Calculate Lifetime Value and Lifetime ROI
            const year1CustomerValueLTV = year1Deals * averageDealSize * lifetimeMultiplier; 
            const year2CustomerValueLTV = year2Deals * averageDealSize * lifetimeMultiplier; 
            const lifetimeROI_Year1 = year1Investment > 0 ? ((year1CustomerValueLTV - year1Investment) / year1Investment) * 100 : (year1CustomerValueLTV > 0 ? Infinity : 0); 
            const lifetimeROI_Year2 = year2Investment > 0 ? ((year2CustomerValueLTV - year2Investment) / year2Investment) * 100 : (year2CustomerValueLTV > 0 ? Infinity : 0); 

            // --- Update UI Elements ---
            outputs.totalSDRCompensationPerSDR.textContent = '$' + formatNumber(Math.round(totalMonthlyCompPerSDR));
            let avgMonthlyLeadsDisplay = fullyRampedMonthlyLeads;
            if (isRampingUp && totalAnnualLeadsYear1 > 0) { // If ramping and leads exist, show average
                 avgMonthlyLeadsDisplay = totalAnnualLeadsYear1 / 12;
            } else if (numberOfSDRs === 0) { // If no SDRs, no leads
                 avgMonthlyLeadsDisplay = 0;
            }
            outputs.monthlyLeads.textContent = formatNumber(Math.round(avgMonthlyLeadsDisplay)); 
            outputs.monthlyLeadsNote.classList.toggle('hidden', !isRampingUp);
            outputs.annualLeads.textContent = formatNumber(Math.round(totalAnnualLeadsYear1));
            outputs.annualLeadsNote.classList.toggle('hidden', !isRampingUp);
            outputs.costPerLead.textContent = '$' + formatNumber(Math.round(costPerLead));
            outputs.costPerAcquisition.textContent = '$' + formatNumber(Math.round(costPerAcquisition));
            outputs.cplNote.textContent = numberOfSDRs > 0 ? "(Y1 Total Inv. / Y1 Leads)" : "(N/A)";
            outputs.cpaNote.textContent = numberOfSDRs > 0 ? "(Y1 Total Inv. / Y1 New Deals)" : "(N/A)";

            outputs.annualPipeline.textContent = '$' + formatNumber(Math.round(annualPipelineYear1));
            outputs.firstRevenueMonth.textContent = firstRevenueMonth > 0 ? formatNumber(firstRevenueMonth) : '--';
            outputs.firstRevenueAmount.textContent = formatNumber(Math.round(firstRevenueAmount)); 
            outputs.salesCycleDisplay.textContent = averageSalesCycle;
            outputs.year1Deals.textContent = formatNumber(Math.round(year1Deals));
            outputs.conversionRateDisplay.textContent = leadConversionRate;
            outputs.year1Revenue.textContent = '$' + formatNumber(Math.round(year1Revenue));
            outputs.year1GrossProfit.textContent = '$' + formatNumber(Math.round(year1GrossProfit));
            outputs.grossMarginDisplayY1.textContent = averageGrossMargin;
            outputs.unrealizedRevenueY2.textContent = '$' + formatNumber(Math.round(unrealizedRevenueY2));

            outputs.year2Deals.textContent = formatNumber(Math.round(year2Deals));
            outputs.year2Revenue.textContent = '$' + formatNumber(Math.round(year2NewRevenue)); 
            outputs.year2GrossProfit.textContent = '$' + formatNumber(Math.round(year2NewGrossProfit)); 
            outputs.grossMarginDisplayY2.textContent = averageGrossMargin;
            outputs.renewalSection.classList.toggle('hidden', year1RenewalRevenue <= 0);
            outputs.year1RenewalRevenue.textContent = '$' + formatNumber(Math.round(year1RenewalRevenue));
            outputs.ltvDisplayRenewal.textContent = customerLifetimeValueNum;
            outputs.year2TotalRevenue.textContent = '$' + formatNumber(Math.round(year2TotalRevenue)); 

            outputs.monthlySDRCompensationTeam.textContent = '$' + formatNumber(Math.round(monthlySDRTeamTotalCompensation));
            outputs.monthlySaaSCostTeam.textContent = '$' + formatNumber(Math.round(monthlySaaSTeamCost));
            
            const showOverheadsSection = includeFractionalSales || includeHRPayrollOverheads;
            outputs.operationalOverheadsSection.style.display = showOverheadsSection ? 'block' : 'none';
            outputs.operationalOverheadsSeparator.style.display = showOverheadsSection ? 'block' : 'none';

            outputs.totalFractionalSalesCostSection.style.display = includeFractionalSales ? 'block' : 'none';
            outputs.totalAnnualFractionalSalesCost.textContent = '$' + formatNumber(Math.round(totalAnnualFractionalSalesCostY1));
            outputs.fractionalSalesCostCalcNote.textContent = `(Onboarding + Y1 Ongoing)`;


            outputs.totalHRPayrollOverheadsSection.style.display = includeHRPayrollOverheads ? 'block' : 'none';
            outputs.totalAnnualHRPayrollOverheads.textContent = '$' + formatNumber(Math.round(monthlyHRPayrollOverheadsTeamCost * 12));
            outputs.hrPayrollOverheadsCalcNote.textContent = `($${formatNumber(hrPayrollOverheadsPerSDR)}/SDR/mo x ${numberOfSDRs} SDRs x 12)`;

            outputs.monthlyTotalCost.textContent = '$' + formatNumber(Math.round(year1Investment > 0 ? year1Investment / 12 : 0)); 
            outputs.monthlyTotalCostNote.textContent = numberOfSDRs > 0 ? "(Avg. SDR Comp + SaaS + Opt. Overheads)" : "(N/A)";
            outputs.annualInvestment.textContent = '$' + formatNumber(Math.round(year1Investment));

            outputs.year1InvestmentDisplayROI.textContent = '$' + formatNumber(Math.round(year1Investment));
            outputs.year1GrossProfitDisplayROI.textContent = '$' + formatNumber(Math.round(year1GrossProfit)); 
            outputs.year1ROI.textContent = formatPercentage(year1ROI);
            outputs.lifetimeValue1Section.classList.toggle('hidden', lifetimeMultiplier <= 1);
            outputs.year1CustomerValue.textContent = '$' + formatNumber(Math.round(year1CustomerValueLTV));
            outputs.ltvDisplayValue1.textContent = customerLifetimeValueNum;
            outputs.lifetimeROI1Section.classList.toggle('hidden', lifetimeMultiplier <= 1);
            outputs.lifetimeROI_Year1.textContent = formatPercentage(lifetimeROI_Year1);

            outputs.year2InvestmentDisplayROI.textContent = '$' + formatNumber(Math.round(year2Investment));
            outputs.year2GrossProfitDisplayROI.textContent = '$' + formatNumber(Math.round(year2TotalGrossProfit)); 
            outputs.year2ROI.textContent = formatPercentage(year2ROI);
            outputs.year2InvestmentNote.textContent = numberOfSDRs > 0 ? "(SDR Comp + SaaS + Opt. Overheads)" : "(N/A)";
            outputs.lifetimeValue2Section.classList.toggle('hidden', lifetimeMultiplier <= 1);
            outputs.year2CustomerValue.textContent = '$' + formatNumber(Math.round(year2CustomerValueLTV));
            outputs.ltvDisplayValue2.textContent = customerLifetimeValueNum;
            outputs.lifetimeROI2Section.classList.toggle('hidden', lifetimeMultiplier <= 1);
            outputs.lifetimeROI_Year2.textContent = formatPercentage(lifetimeROI_Year2);

            expSalesCycle.textContent = averageSalesCycle;
            expConversionRate.textContent = leadConversionRate;

            // Update charts
            updateYear1FinancialChart(chartLabels, cumulativeInvestmentDataY1, cumulativeGrossProfitDataY1, cumulativeNetProfitDataY1, displayBreakeven);
            updateYear1ROIPercentageChart(year1ROI, lifetimeROI_Year1, year1Investment, lifetimeMultiplier > 1);
            updateYear2ROIPercentageChart(year2ROI, lifetimeROI_Year2, year2Investment, lifetimeMultiplier > 1);
        }

        // --- PDF Generation ---
        function generatePdf() {
            if (!window.jspdf || !window.html2canvas) { showErrorMessage("PDF library not loaded. Please refresh."); return; }
            const { jsPDF } = window.jspdf;
            const elementToCapture = pdfContentArea;
            
            // Temporarily show explanations if hidden, so they are included in PDF
            const explanationWasHidden = !explanationContent.classList.contains('show');
            if (explanationWasHidden) { 
                explanationContent.classList.add('show'); 
            }
            
            const options = { 
                scale: 1.5, // Higher scale for better quality, but larger file
                useCORS: true, 
                logging: false, 
                backgroundColor: '#ffffff', 
                scrollX: 0, 
                scrollY: -window.scrollY, // Capture from the top
                windowWidth: elementToCapture.scrollWidth, 
                windowHeight: elementToCapture.scrollHeight 
            };

            html2canvas(elementToCapture, options).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 0.8); // JPEG for smaller size
                const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                
                const pdfWidth = pdf.internal.pageSize.getWidth(); 
                const pdfHeight = pdf.internal.pageSize.getHeight(); 
                const margin = 10; // 10mm margin

                const imgOriginalWidth = canvas.width; 
                const imgOriginalHeight = canvas.height; 
                const aspectRatio = imgOriginalWidth / imgOriginalHeight;
                
                // Calculate image dimensions in PDF, maintaining aspect ratio
                let pdfImgWidth = pdfWidth - (2 * margin); 
                let pdfImgHeight = pdfImgWidth / aspectRatio;
                
                // Calculate number of pages needed
                let totalPdfPages = Math.ceil(pdfImgHeight / (pdfHeight - (2 * margin))); 
                if (totalPdfPages === 0) totalPdfPages = 1;
                
                let currentYOnCanvas = 0; // Tracks the Y position on the source canvas

                for (let i = 0; i < totalPdfPages; i++) {
                    if (i > 0) pdf.addPage();
                    
                    // Calculate the height of the slice to take from the original canvas for this PDF page
                    let sliceHeightOnCanvas = (pdfHeight - 2 * margin) * (imgOriginalHeight / pdfImgHeight); 
                    
                    // Adjust slice height if it's the last page and goes beyond original canvas
                    if (currentYOnCanvas + sliceHeightOnCanvas > imgOriginalHeight) { 
                        sliceHeightOnCanvas = imgOriginalHeight - currentYOnCanvas; 
                    }

                    // Create a temporary canvas to draw the slice
                    const tempCanvas = document.createElement('canvas'); 
                    tempCanvas.width = imgOriginalWidth; 
                    tempCanvas.height = sliceHeightOnCanvas; 
                    const tempCtx = tempCanvas.getContext('2d');
                    // Draw the slice from the main canvas to the temporary canvas
                    tempCtx.drawImage(canvas, 0, currentYOnCanvas, imgOriginalWidth, sliceHeightOnCanvas, 0, 0, imgOriginalWidth, sliceHeightOnCanvas);
                    const sliceImgData = tempCanvas.toDataURL('image/jpeg', 0.8);

                    // Calculate the height of this slice when rendered in the PDF
                    let slicePdfHeight = pdfImgWidth / (imgOriginalWidth / sliceHeightOnCanvas); 
                    if (slicePdfHeight > pdfHeight - 2 * margin) { // Cap at max page height
                        slicePdfHeight = pdfHeight - 2 * margin; 
                    }
                    
                    pdf.addImage(sliceImgData, 'JPEG', margin, margin, pdfImgWidth, slicePdfHeight);
                    currentYOnCanvas += sliceHeightOnCanvas;

                    if (currentYOnCanvas >= imgOriginalHeight) break; // Stop if entire canvas is processed
                }
                
                // Restore explanation visibility if it was changed
                if (explanationWasHidden) { explanationContent.classList.remove('show'); }
                
                pdf.save('SalesDevTeam_ROI_Results.pdf'); 
            }).catch(error => { 
                console.error("Error during PDF generation: ", error); 
                showErrorMessage("Could not generate PDF. See console for details."); 
                if (explanationWasHidden) { explanationContent.classList.remove('show'); } 
            });
        }

        // --- Event Listeners ---
        form.addEventListener('input', calculateROI); // Recalculate on any input field change
        form.addEventListener('change', calculateROI); // Recalculate on select/checkbox change

        inputs.includeFractionalSalesManagement.addEventListener('change', () => { 
            const isFractionalSectionDisabled = !inputs.includeFractionalSalesManagement.checked;
            fractionalSalesInputsContainer.classList.toggle('hidden', isFractionalSectionDisabled);
            
            inputs.fractionalOnboardingCost.disabled = isFractionalSectionDisabled;
            inputs.includeOngoingFractionalSupport.disabled = isFractionalSectionDisabled;
            
            // Also manage the state of the nested "ongoing support" section
            const isOngoingDisabledOrFractionalDisabled = isFractionalSectionDisabled || !inputs.includeOngoingFractionalSupport.checked;
            ongoingFractionalSupportContainer.classList.toggle('hidden', isOngoingDisabledOrFractionalDisabled);
            ongoingFractionalSupportContainer.classList.toggle('inputs-disabled', isOngoingDisabledOrFractionalDisabled);
            inputs.ongoingFractionalDuration.disabled = isOngoingDisabledOrFractionalDisabled;
            inputs.ongoingFractionalMonthlyCost.disabled = isOngoingDisabledOrFractionalDisabled;

            if (isFractionalSectionDisabled) { // Reset to defaults if main section is unchecked
                inputs.fractionalOnboardingCost.value = "5675"; 
                inputs.includeOngoingFractionalSupport.checked = false; 
                inputs.ongoingFractionalDuration.value = "6"; 
                inputs.ongoingFractionalMonthlyCost.value = "3750"; 
            }
            calculateROI();
        });
        
        inputs.includeOngoingFractionalSupport.addEventListener('change', () => { 
            const isMainFractionalDisabled = !inputs.includeFractionalSalesManagement.checked; 
            const isOngoingDisabled = !inputs.includeOngoingFractionalSupport.checked || isMainFractionalDisabled;
            
            ongoingFractionalSupportContainer.classList.toggle('hidden', isOngoingDisabled);
            ongoingFractionalSupportContainer.classList.toggle('inputs-disabled', isOngoingDisabled);
            inputs.ongoingFractionalDuration.disabled = isOngoingDisabled;
            inputs.ongoingFractionalMonthlyCost.disabled = isOngoingDisabled;

            if (isOngoingDisabled && !isMainFractionalDisabled) { // Reset ongoing to defaults if unchecked (but main fractional is still checked)
                 inputs.ongoingFractionalDuration.value = "6"; 
                 inputs.ongoingFractionalMonthlyCost.value = "3750"; 
            }
            calculateROI();
        });

        inputs.includeHRPayrollOverheads.addEventListener('change', () => {
            const isDisabled = !inputs.includeHRPayrollOverheads.checked;
            hrPayrollInputsContainer.classList.toggle('hidden', isDisabled);
            hrPayrollInputsContainer.classList.toggle('inputs-disabled', isDisabled);
            inputs.hrPayrollOverheadsPerSDR.disabled = isDisabled;
             if (isDisabled) { // Reset to default if unchecked
                inputs.hrPayrollOverheadsPerSDR.value = "595"; 
            }
            calculateROI();
        });

        inputs.isTeamFullyRamped.addEventListener('change', () => {
            rampUpNote.classList.toggle('hidden', inputs.isTeamFullyRamped.checked);
            calculateROI();
        });

        toggleExplanationsButton.addEventListener('click', () => {
            const isShown = explanationContent.classList.toggle('show');
            toggleExplanationsButton.textContent = isShown ? "Hide Calculation Explanations" : "Show Calculation Explanations";
        });

        downloadPdfButton.addEventListener('click', generatePdf);

        // --- Initial UI State and Calculation on Page Load ---
        function initializeUIState() {
            // Set explicit default values for key inputs on page load
            inputs.sdrMonthlySalary.value = "1900";
            inputs.sdrVariableCommission.value = "800"; 
            inputs.leadsPerSDRMonth.value = "12";
            inputs.averageDealSize.value = "30000"; // UPDATED VALUE
            inputs.averageGrossMargin.value = "60";
            inputs.fractionalOnboardingCost.value = "5675"; // Default for when section is active
            inputs.ongoingFractionalMonthlyCost.value = "3750"; // Default for when section is active
            inputs.hrPayrollOverheadsPerSDR.value = "595"; // Default for when section is active


            // Initialize state of conditional "Fractional Sales Management" section
            const isFractionalSectionInitiallyDisabled = !inputs.includeFractionalSalesManagement.checked;
            fractionalSalesInputsContainer.classList.toggle('hidden', isFractionalSectionInitiallyDisabled);
            inputs.fractionalOnboardingCost.disabled = isFractionalSectionInitiallyDisabled;
            inputs.includeOngoingFractionalSupport.disabled = isFractionalSectionInitiallyDisabled;
            if (isFractionalSectionInitiallyDisabled) {
                inputs.includeOngoingFractionalSupport.checked = false; // Ensure sub-checkbox is also off
            }
            
            // Initialize state of nested "Ongoing Fractional Support" section
            const isOngoingSupportInitiallyDisabled = isFractionalSectionInitiallyDisabled || !inputs.includeOngoingFractionalSupport.checked;
            ongoingFractionalSupportContainer.classList.toggle('hidden', isOngoingSupportInitiallyDisabled);
            ongoingFractionalSupportContainer.classList.toggle('inputs-disabled', isOngoingSupportInitiallyDisabled);
            inputs.ongoingFractionalDuration.disabled = isOngoingSupportInitiallyDisabled;
            inputs.ongoingFractionalMonthlyCost.disabled = isOngoingSupportInitiallyDisabled;
            // Set default values for ongoing support fields even if initially hidden/disabled, so they are ready if enabled
            if (isOngoingSupportInitiallyDisabled) { 
                 inputs.ongoingFractionalDuration.value = "6"; // Default duration
            }


            // Initialize state of "HR & Payroll Overheads" section
            const isHRPayrollDisabledInitially = !inputs.includeHRPayrollOverheads.checked;
            hrPayrollInputsContainer.classList.toggle('hidden', isHRPayrollDisabledInitially);
            hrPayrollInputsContainer.classList.toggle('inputs-disabled', isHRPayrollDisabledInitially);
            inputs.hrPayrollOverheadsPerSDR.disabled = isHRPayrollDisabledInitially;
            if (isHRPayrollDisabledInitially) {
                // Value is already set by the general defaults above, no need to reset if already matching
            } else { 
                // If checked by default in HTML, ensure value is populated if it wasn't already
                if (!inputs.hrPayrollOverheadsPerSDR.value) inputs.hrPayrollOverheadsPerSDR.value = "595";
            }

            rampUpNote.classList.toggle('hidden', inputs.isTeamFullyRamped.checked);
            
            calculateROI(); // Perform initial calculation
        }
        document.addEventListener('DOMContentLoaded', initializeUIState);
    </script>
</body>
</html>
